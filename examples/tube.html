<!doctype html>
<head>
    <title>Tube Example</title>
    <script src="../dist/threebox.js" type="text/javascript"></script>
    <script src="config.js"></script>

    <script src='https://api.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body, html { 
            width: 100%;
            height: 100%;
            margin: 0;
        }
        #map { 
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id='map' class='map'></div>

    <script>

        if(!config) console.error("Config not set! Make a copy of 'config_template.js', add in your access token, and save the file as 'config.js'.");
        
        mapboxgl.accessToken = config.accessToken;
        var origin = [-122.4340, 37.7353];

        var map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/light-v9',
          center: origin,
          zoom: 15.95,
          pitch: 60,
          heading: 41,
          hash: true
        });


        map.on('style.load', function() {

            map.addLayer({
                id: 'custom_layer',
                type: 'custom',
                renderingMode: '3d',
                onAdd: function(map, mbxContext){

                    window.tb = new Threebox(map, mbxContext);
                    tb.setupDefaultLights();

                    var options = {
                        geometry: line,
                        radius: 1,
                        segments: 120,
                        smoothen: 1,
                        material: 'MeshStandardMaterial',
                        color:'red'
                    }

                    tube = tb.tube(options);
                    tb.add(tube);
                },
                
                render: function(gl, matrix){
                    tb.update();
                }
            });
        });


        var line = [
          [
            -122.483139,
            37.752801,2000
          ],
          [
            -122.450180,
            37.7511723
          ],
          [
            -122.413787,
            37.7593156
          ],
          [
            -122.437820,
            37.782654
          ],
          [
            -122.474899,
            37.777770
          ],
          [
            -122.494812,
            37.745200
          ],
          [
            -122.472152,
            37.716417
          ],
          [
            -122.417221,
            37.727823
          ]
        ]

        var bigLine = [
          [
            -122.483139,
            37.752801
          ],
          [
            120.86630,
            21.900605,
            0
          ]
        ]

        var testLine = [
            [5,5],
            [-5,-5]
        ]
    </script>
</body>